---
import * as icons from "~/assets/img/icons";
import { P } from "~/components/semantics";
import Heading from "~/components/semantics/Heading.astro";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "~/components/starwind/tabs";
import { Abstract, Definition, Explanation, Important, Info, Tip } from "~/components/ui/callouts";
import { PowerShellBlock, PowerShellInline } from "~/components/ui/code";
import CodeBlock from "~/components/ui/code/CodeBlock.astro";
import InlineCode from "~/components/ui/code/InlineCode.astro";
import NushellBlock from "~/components/ui/code/nushell/NushellBlock.astro";
import NushellInline from "~/components/ui/code/nushell/NushellInline.astro";
import { B, I } from "~/components/ui/font";
import Mono from "~/components/ui/font/Mono.astro";
import { List, ListItem } from "~/components/ui/list";
import ToDo from "~/components/utils/ToDo";
import NotesLayout from "~/layouts/NotesLayout.astro";
import NotesSection from "~/layouts/NotesSection.astro";
---

<NotesLayout title="Introducción a Nushell" description="...">
    <Abstract>
        ...
    </Abstract>

    <NotesSection id="nushell-intro-install">
        <Heading headingLevel="h2" Icon={icons.Table}>
            Nushell: ¿qué es y cómo instalarlo?
        </Heading>

        <Definition>
            <span slot="title">¿Qué es Nushell?</span>
            <P>
                <B>Nushell</B> es un shell moderno orientado a <I>datos estructurados</I>. En lugar de pasar texto plano
                por la tubería, Nushell trabaja con <I>tablas de registros tipados</I> (filas y columnas). Este enfoque
                hace más simple y seguro filtrar, transformar y combinar información proveniente de archivos, APIs o
                comandos externos. Su sintaxis es concisa, declarativa y coherente entre plataformas.
            </P>
        </Definition>

        <Info>
            <span slot="title">
                Características clave
            </span>
            <List>
                <ListItem icon={icons.FlowArrow}>
                    <B>Pipeline estructurada</B>: comandos como <NushellInline code="where" />, <NushellInline
                        code="select"
                    /> y <NushellInline code="sort-by" /> operan sobre columnas con tipos definidos.
                </ListItem>
                <ListItem icon={icons.Database}>
                    <B>Formatos de datos</B>: lectura y escritura directa de JSON, CSV, TOML, YAML, Parquet y otros
                    formatos comunes.
                </ListItem>
                <ListItem icon={icons.Terminal}>
                    <B>Multiplataforma</B>: funciona en Windows, macOS y Linux.
                </ListItem>
            </List>
        </Info>

        <P>
            Para instalar Nushell, existen varios métodos según tu sistema operativo. A continuación se muestran las
            opciones de instalación usando los gestores de paquetes que utilizamos en el curso.
        </P>

        <Tabs defaultValue="windows">
            <TabsList>
                <TabsTrigger value="windows">Windows</TabsTrigger>
                <TabsTrigger value="macos">macOS</TabsTrigger>
                <TabsTrigger value="linux">Linux</TabsTrigger>
            </TabsList>
            <TabsContent value="windows">
                <PowerShellBlock code={`scoop install nu`}>
                    <span slot="title">Desde la terminal</span>
                </PowerShellBlock>
            </TabsContent>
            <TabsContent value="macos">
                <PowerShellBlock code={`brew install nushell`}>
                    <span slot="title">Desde la terminal</span>
                </PowerShellBlock>
            </TabsContent>
            <TabsContent value="linux">
                <PowerShellBlock code={`nix profile add nixpkgs#nushell`}>
                    <span slot="title">
                        Desde la terminal
                    </span>
                </PowerShellBlock>
            </TabsContent>
        </Tabs>

        <P>
            Tras instalar, inicia <PowerShellInline code="nu" /> en tu terminal para usar Nushell. Puedes configurar tu
            shell por defecto o integrar <PowerShellInline code="nu" /> como intérprete dentro de tu editor (por
            ejemplo, VS Code) sin reemplazar tu shell actual.
        </P>
    </NotesSection>

    <NotesSection id="...">
        <Heading
            headingLevel="h2" Icon={null}
            slot="heading"
        >
            ...
        </Heading>

        <ToDo
            client:only="react"
            metadata={{
                tasks: [
                    "Definir id",
                    "Definir el título y su ícono",
                    "Agregar texto 'al rededor' del código para contextualizar",
                    "Reemplazar placeholders como 'path/to/...' por valores reales",
                    `...`,
                ],
            }}
        />

        <NushellBlock code={`
            let scripts_path = "dibs/scripts"
            mkdir $scripts_path
          `} />
    </NotesSection>

    <NotesSection id="h2-nushell-pipeline">
        <Heading
            headingLevel="h2" Icon={icons.FlowArrow}
            slot="heading"
        >
            Pipeline y datos estructurados en Nushell
        </Heading>

        <Definition>
            <Fragment slot="title">¿Qué fluye por el pipeline?</Fragment>

            <P>
                En Nushell <b>fluyen filas (registros) y tablas</b>. Muchos comandos emiten tablas con columnas tipadas;
                filtrar, ordenar y proyectar columnas es natural y conciso.
            </P>
        </Definition>

        <Explanation>
            <P>
                Listar archivos y quedarte con los nombres de los <Mono>*.md</Mono> más recientes:
            </P>

            <CodeBlock
                lang="nu" icon={icons.FileText}
                title="Filtrar y proyectar en tablas"
                code={`
ls | where type == File | where name ends-with '.md' | sort-by modified -r | get name
`}
            />

            <P class="mt-4">
                Una vez instalado, ejecuta <PowerShellInline code="nu" /> en tu terminal para comenzar a usar Nushell.
                Puedes establecerlo como tu shell predeterminada o integrarlo en tu editor (por ejemplo, VS Code) sin
                reemplazar la actual.
            </P>
        </Explanation>
    </NotesSection>

    <NotesSection id="h2-nushell-rutas">
        <Heading
            headingLevel="h2" Icon={icons.FolderOpen}
            slot="heading"
        >
            Rutas y portabilidad
        </Heading>

        <P>
            Para construir rutas portables, usa <NushellInline code="path join" /> en lugar de concatenar strings:
        </P>

        <CodeBlock
            lang="nu" icon={icons.FolderOpen}
            title="Construir rutas portables" code={`
let scripts = (path join 'dibs' 'scripts')
mkdir $scripts
`}
        />

        <Tip>
            <span slot="title">Redirección silenciosa</span>
            Si querés ocultar salida en la terminal, podés usar <InlineCode code="> /dev/null" /> en sistemas Unix, o
            directamente confiar en comandos que no emiten salida cuando todo salió bien (muchos subcomandos de Nushell
            son silenciosos por defecto).
        </Tip>
    </NotesSection>

    <NotesSection id="h2-nushell-ventajas">
        <Heading
            headingLevel="h2" Icon={icons.Sparkle}
            slot="heading"
        >
            ¿Qué ofrece Nushell que puede resultarte útil?
        </Heading>

        <List class="mt-2">
            <ListItem icon={icons.Table}>
                <b>Tablas primero</b>: la salida de muchos comandos ya es tabular. Operaciones como <Mono>where</Mono>,
                <Mono>get</Mono>,
                <Mono>select</Mono> y <Mono>group-by</Mono> son concisas y consistentes.
            </ListItem>
            <ListItem icon={icons.BracketsCurly} class="mt-2">
                <b>Soporte nativo para formatos</b>: <Mono>open</Mono> detecta <Mono>.json</Mono>, <Mono>.toml</Mono>,
                <Mono>.csv</Mono>, etc., y los convierte a datos estructurados listos para consultar.
            </ListItem>
            <ListItem icon={icons.ChartBar} class="mt-2">
                <b>Trabajo con datos</b>: con paquetes opcionales como <Mono>dfr</Mono> (basado en Polars) podés
                realizar transformaciones de tipo dataframe directamente desde el shell.
            </ListItem>
        </List>

        <Important>
            <span slot="title">¿Hay algo que se pueda en Nushell y no en PowerShell?</span>
            En la práctica, ambos shells son muy capaces. Nushell destaca por su <b>UX tabular integrada</b> y por su <b
            >línea de comandos centrada en datos estructurados</b> desde el diseño —lo que simplifica ciertos flujos con
            JSON/CSV/Parquet sin escribir código adicional. PowerShell, por su parte, se apoya en <Mono>.NET</Mono>
            y su ecosistema, ofreciendo integración profunda con APIs y tipos del runtime.
        </Important>
    </NotesSection>

    <NotesSection id="h2-nushell-ejemplos">
        <Heading
            headingLevel="h2" Icon={icons.Terminal}
            slot="heading"
        >
            Ejemplos rápidos en Nushell
        </Heading>

        <CodeBlock
            lang="nu" icon={icons.Clock}
            title="Tiempo total de archivos .log" code={`
ls *.log | get size | math sum
`}
        />

        <CodeBlock
            lang="nu" icon={icons.MagnifyingGlass}
            title="Buscar texto en archivos y devolver coincidencias"
            code={`
rg -n "error" | lines | where $it != "" | first 5
`}
        />

        <CodeBlock
            lang="nu" icon={icons.ArrowRight}
            title="Convertir CSV a JSON" code={`
open data.csv | to json
`}
        />
    </NotesSection>

    <NotesSection id="h2-nushell-cierre">
        <Heading
            headingLevel="h2" Icon={icons.Check}
            slot="heading"
        >
            Cierre
        </Heading>

        <P>
            Si ya venís de PowerShell, Nushell te resultará familiar en espíritu: pipelines expresivos, comandos
            composables y foco en automatizar. La diferencia es de énfasis: Nushell optimiza <b>consultar y transformar
                datos</b> en la propia terminal.
        </P>
    </NotesSection>
</NotesLayout>
